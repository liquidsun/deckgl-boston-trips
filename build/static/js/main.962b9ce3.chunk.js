(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{134:function(e,t,n){e.exports=n(151)},139:function(e,t,n){},143:function(e,t){},146:function(e,t,n){},147:function(e,t,n){},148:function(e,t,n){},151:function(e,t,n){"use strict";n.r(t);var i=n(3),a=n.n(i),l=n(52),o=n.n(l),r=(n(139),n(1)),s=n(2),h=n(5),g=n(4),u=n(8),p=n(6),d=n(107),m=n(101),c=n(157),f=n(158),v=n(159),b=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(h.a)(this,Object(g.a)(t).call(this,e))).animationFrame=void 0,n.state={currentTime:0},n.animationFrame=null,n.animate=n.animate.bind(Object(u.a)(n)),n.getColor=n.getColor.bind(Object(u.a)(n)),n}return Object(p.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.animate()}},{key:"componentWillUnmount",value:function(){null!=this.animationFrame&&window.cancelAnimationFrame(this.animationFrame)}},{key:"animate",value:function(){if(null!=this.props.loopLength){var e=Date.now()-this.props.timestampOffset,t=this.props.loopTimeMilliseconds;this.setState({currentTime:e%t*(this.props.loopLength/t)})}this.animationFrame=window.requestAnimationFrame(this.animate.bind(this))}},{key:"getColor",value:function(e){var t=this.props.color,n=e.color;if(null!=n&&(t=n),null!=e.start_id&&this.props.highlightedOutgoingTrips.length>0){null!=this.props.highlightedOutgoingTrips.find(function(t){return e.start_id.toLowerCase()===t.toLowerCase()})&&(t=this.props.highlightColor)}if(null!=e.end_id&&this.props.highlightedIncomingTrips.length>0){null!=this.props.highlightedIncomingTrips.find(function(t){return e.end_id.toLowerCase()===t.toLowerCase()})&&(t=this.props.incomingHighlightColor)}return t}},{key:"render",value:function(){var e=this.props,t=e.handleOnHover,n=e.initialViewState,a=e.nodes,l=e.trips,o=e.trailLength,r=e.viewport,s=this.state.currentTime,h=[];return null!=l&&h.push(new c.a({id:"trips",data:l,getPath:function(e){return e.segments.map(function(e){return e.coordinates})},getTimestamps:function(e){return e.segments.map(function(e){return e.timestamp})},getColor:this.getColor,opacity:.7,widthMinPixels:2,trailLength:o,currentTime:s})),null!=a&&h.push(new f.a({id:"geojson-layer",data:a,filled:!0,getFillColor:function(){return[0,255,178,150]},stroked:!0,extruded:!1,pointRadiusScale:.3,getRadius:function(e){return e.properties.count},pickable:!0,autoHighlight:!0,highlightColor:[0,255,178,250],onHover:t,onClick:function(e){return console.log(e.object.properties.name)}})),0===h.length?null:i.createElement(v.a,{initialViewState:n,viewState:r,layers:h})}}]),t}(i.Component),w=(n(146),function(e){function t(){return Object(r.a)(this,t),Object(h.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return i.createElement("div",{className:"spinner-container"},i.createElement("div",{className:"spinner"},i.createElement("div",{className:"spinner-circle spinner-circle-outer"}),i.createElement("div",{className:"spinner-circle spinner-circle-inner"}),i.createElement("div",{className:"spinner-circle spinner-circle-single-1"}),i.createElement("div",{className:"spinner-circle spinner-circle-single-2"}),i.createElement("div",{className:"text"},"Loading")))}}]),t}(i.Component));function T(e){return new URL(window.location.href).searchParams.get(e)}function C(e){if(null!=e){var t=Number(e);if(!Number.isNaN(t))return t}return null}function O(e,t,n){for(var i=e.length>0?e.split("&"):[],a=!1,l=0;l<i.length;l++){i[l].split("=")[0]===t&&(i[l]=t+"="+(n||""),a=!0)}return!1===a&&i.push(t+"="+(n||"")),i.join("&")}var k={getKnownUrlParameters:function(){var e={dataSampleIdx:null,loopTime:null,trailLength:null,highlightedOutgoingTrips:null,highlightedIncomingTrips:null},t=C(T("dataIdx"));null!=t&&t>=0&&(e.dataSampleIdx=t);var n=C(T("loopTime"));null!=n&&n>0&&n<999999&&(e.loopTime=n);var i=C(T("trailLength"));null!=i&&i>0&&i<999999&&(e.trailLength=i);var a=T("highlightOutgoingTrips");null!=a&&a.length>0&&(e.highlightedOutgoingTrips=a.split(","));var l=T("highlightIncomingTrips");return null!=l&&l.length>0&&(e.highlightedIncomingTrips=l.split(",")),e},updateUrlParameters:function(e){var t=decodeURIComponent(window.location.search.substring(1));null!=e.dataSampleIdx&&(t=O(t,"dataIdx",String(e.dataSampleIdx))),null!=e.loopTime&&(t=O(t,"loopTime",String(e.loopTime))),null!=e.trailLength&&(t=O(t,"trailLength",String(e.trailLength))),null!=e.highlightedOutgoingTrips&&(t=O(t,"highlightOutgoingTrips",e.highlightedOutgoingTrips.join(",")));var n="?"+t;window.history.pushState({},"",n)}},L=n(100),E=(n(147),n(148),n(149),{color:[0,89,255],colors:[[0,255,246],[255,235,86],[255,109,245],[0,255,119]],dataSamples:[{title:"Wednesday",tripsUrl:"./data/weekday/trips.json",geoJsonUrl:"./data/weekday/geojson-stops.json",nodeListUrl:"./data/weekday/stops-list.json",initialPartialViewport:{longitude:-71.081949,latitude:42.349226,zoom:12}},{title:"Sunday",tripsUrl:"./data/weekend/trips.json",geoJsonUrl:"./data/weekend/geojson-stops.json",nodeListUrl:"./data/weekend/stops-list.json",initialPartialViewport:{longitude:-71.081949,latitude:42.349226,zoom:12}}],highlightColor:[214,21,21],incomingHighlightColor:[244,252,3],initialLoopTimeMinutes:3,initialTrailLength:100,initialViewport:{longitude:-71.081949,latitude:42.349226,zoom:12,maxZoom:20,pitch:45,bearing:0,width:500,height:500},mapboxStyle:Object({NODE_ENV:"production",PUBLIC_URL:"."}).REACT_APP_MAPBOX_STYLE,mapboxToken:Object({NODE_ENV:"production",PUBLIC_URL:"."}).REACT_APP_MAPBOX_TOKEN,nodeNameLabel:"Stop name:",nodeIdLabel:"Stop id:",nodeCount:"Number of trips: ",nodeLabelOutgoing:"outgoing trips for stop:",nodeLabelIncoming:"incoming trips for stop:",title:"Trips"}),y=function(e){function t(e){var n;Object(r.a)(this,t),(n=Object(h.a)(this,Object(g.a)(t).call(this,e))).intervalId=void 0,n.knownUrlParams=void 0,n.timestampOffset=void 0,n.knownUrlParams=k.getKnownUrlParameters();var i=n.knownUrlParams.dataSampleIdx||0;return n.state={appConfig:E,dataSampleIdx:i,friendlyName:"",friendlyTime:"",hideInfoBox:!1,highlightedOutgoingTrips:null!=n.knownUrlParams.highlightedOutgoingTrips?n.knownUrlParams.highlightedOutgoingTrips:[],highlightedIncomingTrips:null!=n.knownUrlParams.highlightedIncomingTrips?n.knownUrlParams.highlightedIncomingTrips:[],loopLength:1e3,loopTimeMinutes:n.knownUrlParams.loopTime||E.initialLoopTimeMinutes,nodeList:[],nodes:null,percentThroughLoop:0,popupInfo:null,startDate:new Date(2e3,1,1,0,0,0),timeMultiplier:1,trailLength:n.knownUrlParams.trailLength||E.initialTrailLength,trips:null,viewport:Object.assign({},E.initialViewport,E.dataSamples[i].initialPartialViewport)},n.timestampOffset=Date.now(),n.handleDataChange=n.handleDataChange.bind(Object(u.a)(n)),n.handleHighlightOutgoingTripsChange=n.handleHighlightOutgoingTripsChange.bind(Object(u.a)(n)),n.handleHighlightIncomingTripsChange=n.handleHighlightIncomingTripsChange.bind(Object(u.a)(n)),n.handleHighlightNodeReload=n.handleHighlightNodeReload.bind(Object(u.a)(n)),n.handleLoopTimeMinutesChange=n.handleLoopTimeMinutesChange.bind(Object(u.a)(n)),n.handleOnHoverGeoPoint=n.handleOnHoverGeoPoint.bind(Object(u.a)(n)),n.handleTimeChange=n.handleTimeChange.bind(Object(u.a)(n)),n.handleTrailLengthChange=n.handleTrailLengthChange.bind(Object(u.a)(n)),n.loadNodeList=n.loadNodeList.bind(Object(u.a)(n)),n.loadTrips=n.loadTrips.bind(Object(u.a)(n)),n.updateBoxInfo=n.updateBoxInfo.bind(Object(u.a)(n)),n}return Object(p.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("resize",this.resize.bind(this)),this.resize(),this.loadTrips(this.state.dataSampleIdx),this.loadNodeList(this.state.dataSampleIdx),this.loadGeoJsonNodes(this.state.dataSampleIdx),this.intervalId=setInterval(function(){return e.updateBoxInfo()},1e3)}},{key:"componentWillUnmount",value:function(){clearInterval(this.intervalId)}},{key:"loadTrips",value:function(e){var t=this,n=this.state.appConfig.dataSamples[e].tripsUrl;Object(m.a)(n,function(e,n){if(null==e){var i=t.state.appConfig.title;null!=n.friendlyName&&(i=n.friendlyName);var a=new Date(Date.parse(n.startTimestamp)),l=n.timeMultiplier,o=n.trips,r=n.loopLength;if(o.length>0&&o.length<=10)for(var s=0;s<o.length;s++)o[s].color=t.state.appConfig.colors[s%t.state.appConfig.colors.length];t.timestampOffset=Date.now(),t.setState({friendlyName:i,startDate:a,trips:o,loopLength:r,timeMultiplier:l})}})}},{key:"loadNodeList",value:function(e){var t=this;Object(m.a)(this.state.appConfig.dataSamples[e].nodeListUrl,function(e,n){null==e&&(n.sort(),t.setState({nodeList:n}))})}},{key:"loadGeoJsonNodes",value:function(e){var t=this;Object(m.a)(this.state.appConfig.dataSamples[e].geoJsonUrl,function(e,n){null==e&&t.setState({nodes:n})})}},{key:"getAnimationTime",value:function(){return this.state.loopLength/(60*this.state.loopTimeMinutes)*1e3}},{key:"updateBoxInfo",value:function(){if(null!=this.state.startDate){var e=Date.now()-this.timestampOffset,t=this.getAnimationTime(),n=e%t,i=Math.floor(n/t*100),a=0*this.state.timeMultiplier+Math.floor(n*(this.state.loopLength/t)),l=this.toFriendlyTime(a);this.setState({friendlyTime:l,percentThroughLoop:i})}}},{key:"toFriendlyTime",value:function(e){var t=e/this.state.timeMultiplier,n=new Date(this.state.startDate.getTime()+1e3*t),i=String(n.getMinutes());return i.length<2&&(i="0"+i),n.getDate()+"/"+(n.getMonth()+1)+"/"+n.getFullYear()+" "+n.getHours()+":"+i}},{key:"handleTimeChange",value:function(e){var t=Date.now()-this.timestampOffset,n=this.getAnimationTime(),i=t%n,a=e.target.value/100*n,l=this.timestampOffset+(i-a);this.timestampOffset=l}},{key:"handleTrailLengthChange",value:function(e){var t=e.target.value;if(null!=t&&t.length>0){var n=parseFloat(t);n<=0?n=1e-4:n>9999999&&(n=9999999),this.setState({trailLength:n}),this.knownUrlParams.trailLength=n,k.updateUrlParameters(this.knownUrlParams)}else this.setState({trailLength:this.state.appConfig.initialTrailLength}),this.knownUrlParams.trailLength=null,k.updateUrlParameters(this.knownUrlParams)}},{key:"handleLoopTimeMinutesChange",value:function(e){var t=e.target.value;if(null!=t&&t.length>0){var n=parseFloat(t);n<=0?n=1e-4:n>9999999&&(n=9999999);var i=Date.now()-this.timestampOffset,a=this.getAnimationTime(),l=this.state.loopLength/(60*n)*1e3,o=this.timestampOffset+(i%l-l*(i%a/a));this.timestampOffset=o,this.setState({loopTimeMinutes:n}),this.knownUrlParams.loopTime=n,k.updateUrlParameters(this.knownUrlParams)}else this.setState({loopTimeMinutes:this.state.appConfig.initialLoopTimeMinutes}),this.knownUrlParams.trailLength=null,k.updateUrlParameters(this.knownUrlParams)}},{key:"handleHighlightIncomingTripsChange",value:function(e){null==e&&(e=[]);var t=e.map(function(e){return e.value}),n=this.state.highlightedIncomingTrips.length>t.length;this.setState({highlightedIncomingTrips:t}),this.knownUrlParams.highlightedIncomingTrips=t,k.updateUrlParameters(this.knownUrlParams),n&&this.handleHighlightNodeReload()}},{key:"handleHighlightOutgoingTripsChange",value:function(e){null==e&&(e=[]);var t=e.map(function(e){return e.value}),n=this.state.highlightedOutgoingTrips.length>t.length;this.setState({highlightedOutgoingTrips:t}),this.knownUrlParams.highlightedOutgoingTrips=t,k.updateUrlParameters(this.knownUrlParams),n&&this.handleHighlightNodeReload()}},{key:"handleHighlightNodeReload",value:function(){this.setState({trips:Object.assign([],this.state.trips)})}},{key:"handleDataChange",value:function(e){if(null!=e&&this.state.dataSampleIdx!==e.value){this.handleHighlightOutgoingTripsChange([]),this.handleHighlightIncomingTripsChange([]);var t=e.value;window.history.pushState({},"",""),this.setState({trips:null,dataSampleIdx:t}),this.loadTrips(t),this.loadNodeList(t),this.loadGeoJsonNodes(t),this.handleViewportChange(this.state.appConfig.dataSamples[t].initialPartialViewport),this.knownUrlParams.dataSampleIdx=t,k.updateUrlParameters(this.knownUrlParams)}}},{key:"handleOnHoverGeoPoint",value:function(e){this.setState({popupInfo:null!==e?e.object:null})}},{key:"resize",value:function(){this.handleViewportChange({width:window.innerWidth,height:window.innerHeight})}},{key:"handleViewportChange",value:function(e){this.setState({viewport:Object.assign({},this.state.viewport,e)})}},{key:"handleInfoBoxVisibility",value:function(e){this.setState({hideInfoBox:e})}},{key:"render",value:function(){var e=this,t=this.state,n=t.appConfig,a=t.dataSampleIdx,l=(t.friendlyName,t.friendlyTime),o=t.hideInfoBox,r=t.highlightedOutgoingTrips,s=t.highlightedIncomingTrips,h=t.loopLength,g=t.loopTimeMinutes,u=t.nodeList,p=t.nodes,m=t.percentThroughLoop,c=t.popupInfo,f=t.trailLength,v=t.trips,T=t.viewport,C=this.state.appConfig.dataSamples.map(function(e,t){return{value:t,label:e.title}}),O=u.map(function(e){return{value:e,label:e}}),k=r.map(function(e){return{value:e,label:e}}),E=s.map(function(e){return{value:e,label:e}}),y=i.createElement("span",null);null==v&&(y=i.createElement(w,null));var I=null;null!=c&&(I=i.createElement(d.a,{id:"popup",longitude:c.geometry.coordinates[0],latitude:c.geometry.coordinates[1],closeButton:!1,closeOnClick:!1,anchor:"bottom-left"},i.createElement("div",{className:"popup-inner"},this.state.appConfig.nodeNameLabel," ",null!=c.properties?c.properties.name:"",i.createElement("br",null),this.state.appConfig.nodeIdLabel," ",null!=c.properties?c.properties.stopid:"",i.createElement("br",null),this.state.appConfig.nodeCount," ",null!=c.properties?c.properties.count:"")));var S=null;return this.state.appConfig.dataSamples.length>1&&(S=i.createElement("div",null,i.createElement("h6",null,"Select Data"),i.createElement("div",null,i.createElement(L.a,{options:C,onChange:this.handleDataChange,value:C[a]})))),i.createElement("div",{id:"container"},y,i.createElement("div",{id:"divdeckgl"},i.createElement(d.b,Object.assign({},T,{mapStyle:null!=this.state.appConfig.mapboxStyle?this.state.appConfig.mapboxStyle:"mapbox://styles/liquidsun86/ck5faex8m22n61imiy9hbo1h7",dragRotate:!0,onViewportChange:this.handleViewportChange.bind(this),mapboxApiAccessToken:null!=this.state.appConfig.mapboxToken?this.state.appConfig.mapboxToken:"pk.eyJ1IjoibGlxdWlkc3VuODYiLCJhIjoiY2syeDkwb2RzMDlnbTNncGQ3amU1aGR2OSJ9.YU3MLFHx8BoYbrF0Xl9Lag"}),i.createElement(b,{color:n.color,handleOnHover:this.handleOnHoverGeoPoint,highlightColor:n.highlightColor,incomingHighlightColor:n.incomingHighlightColor,highlightedOutgoingTrips:r,highlightedIncomingTrips:s,initialViewState:n.initialViewport,loopLength:h,loopTimeMilliseconds:this.getAnimationTime(),nodes:p,timestampOffset:this.timestampOffset,trips:v,trailLength:f,viewport:T}),I)),i.createElement("div",{id:"divcredits"},i.createElement("div",null,i.createElement("h6",null,"Credits:")),i.createElement("div",null,i.createElement("h6",null,"Data:",i.createElement("a",{href:"https://www.bluebikes.com/system-data",target:"_blank"}," Boston Blue Bikes"))),i.createElement("div",null,i.createElement("h6",null,"Application:",i.createElement("a",{href:"https://github.com/stevekirks/deckgl-trips",target:"_blank"}," github.com/stevekirks"))),i.createElement("div",null,i.createElement("h6",null,"Data processing and app adjusting: Ivan Vasilyev"))),i.createElement("div",{id:"top-left-container"},i.createElement("div",{id:"title-box"},i.createElement("h1",null,"A day of the Blue Bikes")),i.createElement("div",{id:"divinfo",className:o?"hide":""},i.createElement("button",{id:"btnHideInfoBox",className:"btn-transparent right-align",onClick:function(){return e.handleInfoBoxVisibility(!0)}},"X"),S,i.createElement("h3",null,l),i.createElement("div",null,i.createElement("h6",null,"Adjust point in time:"),i.createElement("input",{className:"full-width",type:"range",min:"0",max:"100",value:String(m),onChange:this.handleTimeChange})),i.createElement("div",null,i.createElement("h6",null,"Adjust animation speed:"),i.createElement("div",{className:"block"},i.createElement("input",{className:"",type:"number",defaultValue:String(g),onInput:this.handleLoopTimeMinutesChange}),i.createElement("label",null,"mins/sec"))),i.createElement("div",null,i.createElement("h6",null,"Adjust trail length:"),i.createElement("div",{className:"block"},i.createElement("input",{type:"number",defaultValue:String(f),onInput:this.handleTrailLengthChange}),i.createElement("label",null,"x"))),i.createElement("div",null,i.createElement("h6",null,"Highlight ",this.state.appConfig.nodeLabelOutgoing),i.createElement("div",null,i.createElement(L.a,{closeMenuOnSelect:!0,isMulti:!0,options:O,onChange:this.handleHighlightOutgoingTripsChange,onMenuClose:this.handleHighlightNodeReload,value:k,maxMenuHeight:100}))),i.createElement("div",null,i.createElement("h6",null,"Highlight ",this.state.appConfig.nodeLabelIncoming),i.createElement("div",null,i.createElement(L.a,{closeMenuOnSelect:!0,isMulti:!0,options:O,onChange:this.handleHighlightIncomingTripsChange,onMenuClose:this.handleHighlightNodeReload,value:E,maxMenuHeight:100})))),i.createElement("button",{id:"btnShowInfoBox",className:"btn-transparent "+(o?"":"hide"),onClick:function(){return e.handleInfoBoxVisibility(!1)}},"SHOW INFO BOX")))}}]),t}(i.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(a.a.createElement(y,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[134,1,2]]]);
//# sourceMappingURL=main.962b9ce3.chunk.js.map